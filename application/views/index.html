<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>房猫房地产管理系统</title>
    <meta name="keywords" content="房猫-前台-首页" />
    <meta name="description" content="房猫-前台-首页" />
    <link href="/static/css/reset.css" rel="stylesheet" type="text/css">
    <link href="/static/css/style.css" rel="stylesheet" type="text/css">
    <link href="/static/js/jquery-ui/jquery-ui.css" rel="stylesheet" type="text/css">
    <!--[if IE 6]><script>document.execCommand("BackgroundImageCache", false, true)</script><![endif]-->
</head>
<body>
    <div class="doc index">
        {{include file='header.html'}}
        <div class="wraper clearfix">
            <div class="index_logo"><a href=""><img src="/static/images/index/index_logo.png" alt=""></a></div>
            <ul class="index-nav">
                <li class="current">我的桌面</li>
                <li>管理工具</li>
                <li>服务窗口</li>
                <li>经纪人学院</li>
                <li>金融服务</li>
                <li>房猫新闻</li>
                <li>文档库</li>
            </ul>
            <div class="content">
                <div class="convenient-btns">
                    <a href="javascript:" class="settingbtn" id="Jsettingbtn"></a>
                    <div class="tableshortcut">
                        <a href="javascript:void(0);" class="a-btns" url="/activity/list_activity"><img src="/static/images/index/s_index_nav1.gif" alt=""></a>
                        <a href="javascript:void(0);" class="a-btns" url="/activity/list_ranking"><img src="/static/images/index/s_index_nav2.gif" alt=""></a>
                        <a href="javascript:void(0);" class="a-btns" url="/agenda/list_agenda"><img src="/static/images/index/s_index_nav3.gif" alt=""></a>
                        <a href="javascript:void(0);" class="a-btns" url="/appointment/book_room"><img src="/static/images/index/s_index_nav4.gif" alt=""></a>
                        <a href="javascript:void(0);" class="a-btns" url="/"><img src="/static/images/index/s_index_nav5.gif" alt=""></a>
                        <a href="javascript:void(0);" class="a-btns" url="/video/list_video"><img src="/static/images/index/s_index_nav6.gif" alt=""></a>
                   </div>
                    <div class="s-cardsetting" id="JsCardsetting" style="display: none;">
                        <div class="s-cardsetting-wrap">
                            <div class="s-cardsetting-left" id="s-cardsetting-left">
                                <h3>已添加板块</h3>
                                <div style="float:left;width:78px;text-align:center;margin-top:18px;border:1px solid #cdcdcd;height:24px;line-height:24px;">我的桌面</div>

                                    <div class="s-cardsetting-content sui-componentWrap">
                                        <div class="s-mod-item ui-icon-trash">
                                            <div class="s-mod-icon"></div>
                                            <div class="s-mod-title">行程管理</div>
                                        </div>
                                        <div class="s-mod-item ui-icon-trash">
                                            <div class="s-mod-icon"></div><div class="s-mod-title">绩效排行</div>
                                        </div>
                                        <div class="s-mod-item ui-icon-trash">
                                        <div class="s-mod-icon"></div><div class="s-mod-title">代办服务</div></div>
                                        <div class="s-mod-item ui-icon-trash">
                                            <div class="s-mod-icon"></div><div class="s-mod-title">预约场地</div>
                                        </div>
                                     </div>
                                </div>
                            <div class="s-cardsetting-right" id="s-cardsetting-right"><h3>未订阅频道</h3>
                                <div class="s-cardsetting-content sui-componentWrap">
                                    <div class="s-mod-item ui-icon-refresh">
                                        <div class="s-mod-icon"></div><div class="s-mod-title">经纪学院</div></div>
                                    <div class="s-mod-item ui-icon-refresh">
                                        <div class="s-mod-icon"></div>
                                        <div class="s-mod-title">房猫服务</div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="news-th">
                        新闻与活动
                </div>
                <div class="new-tb">
                    {{foreach from=$news_list.res_list key=key item=item}}
                        <dl n_id="{{$item.id}}" class="new-box {{if $key%2==0}}fl{{else}}fr{{/if}}">
                            <dt><img src="/uploadfiles/news/{{$item.pic}}" /></dt>
                            <dd><span class="s-tit">{{$item.title|truncate:25:"...":true}}</span><p>{{$item.content|truncate:60:"...":true}}</p>
                            </dd>
                        </dl>
                    {{/foreach}}
                    <div class="pages" style="float:right">
                        {{$pager}}
                    </div>
                </div>
            </div>
            {{include file='footer.html'}}
        </div>
    </div>
    <div class="login-div" id="Jloginpop" style="display:none; cursor: default">
        <a href="javascript:" class="pop-close-btn"></a>
        <p class="p-txt">欢迎登录</p>
        <form action="">
            <div class="input-div">
                <span><em class="input-icon input-tel"></em>| </span><input type="text" name="username" id="username" placeholder="手机号" />
            </div>
            <div class="input-div">
                <span><em class="input-icon input-pwd"></em>| </span><input type="password" name="password" id="password" placeholder="密码"  />
            </div>

            <input type="checkbox" name="password" id="cb_pass">是否记住密码

            <a href="javascript:void(0);" class="sub-btn" id="btn_login">登 录</a>
            <p class="tips" id="login_error" style="display:none"><em></em>手机或密码不对，请重新输入！</p>
            <p class="tips" id="login_error2" style="display:none"><em></em>人员离职,账户停用</p>
        </form>
    </div>
    <!--新闻弹框-->
    <div class="newspop" id="newspop" style="display: none;">
        <a href="javascript:" class="pop-close-btn newspop-btn"></a>
        <div class="popcontent"></div>
    </div>
    <script type="text/javascript" src="/static/js/jquery-ui/jquery-ui.js"></script>
    <script type="text/javascript">
        $(function() {
            //var shortcutItems =["","",""]
            // there's the gallery and the trash
            var $sCardsettingLeft = $("#s-cardsetting-left"),
                    $sCardsettingRight = $("#s-cardsetting-right");

            // let the gallery items be draggable
            $(".s-mod-item", $sCardsettingLeft).draggable({
              //  cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                revert: "invalid", // when not dropped, the item will revert back to its initial position
                containment: ".s-cardsetting",
                helper: "clone",
                cursor: "move"
            });
            $sCardsettingRight.droppable({
                accept: "#s-cardsetting-left .s-mod-item",
                drop: function( event, ui ) {
                    deleteItems( ui.draggable );
                }
            });
            $(".s-mod-item", $sCardsettingRight).draggable({
                //  cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                revert: "invalid", // when not dropped, the item will revert back to its initial position
                containment: ".s-cardsetting",
                helper: "clone",
                cursor: "move"
            });
            $sCardsettingLeft.droppable({
                accept: "#s-cardsetting-right .s-mod-item",
               // activeClass: "custom-state-active",
                drop: function( event, ui ) {
                    recycleItems( ui.draggable );
                }
            });
            function deleteItems( $item ) {
                $item.fadeOut(function() {
                    var $list = $( ".s-cardsetting-content", $sCardsettingRight ).length ?
                            $( ".s-cardsetting-content", $sCardsettingRight ) :
                            $( "<div class='s-cardsetting-content ui-helper-reset'/>" ).appendTo( $sCardsettingRight );
                 $item.removeClass("ui-icon-trash").addClass("ui-icon-refresh");
                  //  $item.find( "a.ui-icon-trash" ).remove();
                    $item.appendTo( $list ).fadeIn();
                });
            }
            function recycleItems( $item ) {
                $item.fadeOut(function() {
                    var $list = $( ".s-cardsetting-content", $sCardsettingLeft ).length ?
                            $( ".s-cardsetting-content", $sCardsettingLeft ) :
                            $( "<div class='s-cardsetting-content ui-helper-reset'/>" ).appendTo( $sCardsettingLeft );
                    $item.removeClass("ui-icon-refresh").addClass("ui-icon-trash");
                    $item.appendTo( $list ).fadeIn();
                });
            }
            $( ".s-cardsetting-content > .s-mod-item" ).click(function( event ) {
                var $item = $( this ), $target = $( event.target );
                if ($item .is( ".ui-icon-trash" ) ) {
                    deleteItems( $item );
                } else if ( $item.is( ".ui-icon-refresh" ) ) {
                    recycleItems( $item );
                }
                return false;
            });
            $("#Jsettingbtn").click(function(){$("#JsCardsetting").toggle();});

        })
        //新闻弹框
        $('.new-box').click(function(){
            $.get('/news/view_news/' + $(this).attr('n_id'), function(html) {
                $('.popcontent').html(html);
                $.blockUI({ message: $('#newspop'),
                    css:{ background: 'none',
                        top:'8%',left:'50%',
                        border: 'none',
                        marginLeft:'-500px',
                        width:'1000px',
                        position:'absolute',cursor:'default'},
                    overlayCSS: {cursor:'default'}});
                $('.newspop-btn').css('right',parseInt((parseInt($(window).width())-1000)/2-$('.newspop-btn').width()));
            });
        });
        var storeuser = {
            set: function(key,user,val) {
                store.set(key, { usern:user, passw:val, time:new Date().getTime() })
            },
            get: function(key) {
                var info = store.get(key)
                if (!info) { return null }
                if (new Date().getTime() - info.time > 86400000) { return null }
                return info
            }
        }
        if(storeuser.get('user')){
            var info = storeuser.get('user')
            $("#username").val(info.usern);
            $("#password").val(info.passw);
        }else{
            $("#username").val('');
            $("#password").val('');
            store.remove('user');
        }
        var redirect_url = "/";
        $("#btn_login").click(function() {
            var username = $("#username").val();
            var password = $("#password").val();
            $.post('/index/login', {username: username, password: password}, function(data) {
                if(data == 1) {
                    if($("#cb_pass").is(':checked')){
                        storeuser.set('user',username,password)
                    }else{
                        store.remove('user');
                    }
                    window.location = redirect_url;
                } else if(data == 2) {
                    $("#login_error").hide();
                    $("#login_error2").show();
                    $("#username").val("");
                    $("#password").val("");
                } else{
                    $("#login_error").show();
                    $("#login_error2").hide();
                    $("#username").val("");
                    $("#password").val("");
                }
            });
        });

        function checkAuth() {
            return $.ajax({
                url: "/index/check_login",
                async: false
            }).responseText;
        }

        $(".a-btns").click(function() {
            redirect_url = $(this).attr('url');
            var result = checkAuth();
            if(result < 1) {
                $.blockUI({ message: $('#Jloginpop'), css:{ background: 'none',top:'100px', border: 'none',width:'410px', height:'410px'}, overlayCSS: {cursor:'default'}});
            } else {
                window.location = redirect_url;
            }
        });

        //关闭弹框
        $(".pop-close-btn").click(function(){
            $.unblockUI();
        });
     </script>
</body>
</html>
